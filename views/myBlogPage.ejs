

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bloging App</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<body>
  <nav class="navbar">
    <!-- Left Side -->
    <div class="nav-left">
        <a href="/notes">Blog <i class="fa-solid fa-blog"></i></a>
        <a href="/myblog">My Blog <i class="fa-solid fa-blog"></i></a>
    </div>
  
    <!-- Right Side -->
    <div class="nav-right">
        <a href="/logout">Logout <i class="fa-solid fa-right-from-bracket"></i></a>
     
    </div>
  </nav>


<h1>My Blogs</h1>

<% if (notes && notes.length > 0) { %>
  <% notes.forEach(note => { %>
    <div class="note-card">
      <h3><%= note.title %></h3>
      <p><%= note.content %></p>
      <% if (note.imageUrl) { %>
  <img src="<%= note.imageUrl %>" alt="Note Image" style="max-width: 100%; height: auto;">
<% } %>
      <div class="note-actions">
        <form action="/notes/<%= note._id %>?_method=DELETE" method="POST" style="display:inline;">
          <button type="submit" class="btn btn-danger btn-sm">Delete</button>
        </form>
        <button class="btn btn-secondary edit-btn" data-id="<%= note._id %>" data-title="<%= note.title %>" data-content="<%= note.content %>">Edit</button>
      </div>
    </div>
  <% }) %>
<% } else { %>
  <p>No blogs found. Create one!</p>
<% } %>

<script>
window.onload = function () {
  const modal = document.getElementById("editModal");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const editForm = document.getElementById("editForm");

  const editBtns = document.querySelectorAll('.edit-btn');

  editBtns.forEach(btn => {
    btn.addEventListener('click', function() {
      const noteId = this.dataset.id;
      const noteTitle = this.dataset.title;
      const noteContent = this.dataset.content;

      console.log("Editing note:", noteId);

      if (!noteId) {
        alert("Error: Note ID not found!");
        return;
      }

      document.getElementById("modal-title").value = noteTitle;
      document.getElementById("modal-content").value = noteContent;

      modal.style.display = "flex";
      editForm.action = `/notes/${noteId}?_method=PUT`;
    });
  });

  if (closeModalBtn) {
    closeModalBtn.addEventListener('click', function() {
      modal.style.display = "none";
    });
  }

  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('deleted') === 'true') {
    Swal.fire({
      title: "Deleted!",
      text: "The blog was deleted successfully.",
      icon: "success",
      showConfirmButton: false,
      timer: 2000,
      position: "top-end",
      toast: true
    });
  }
};
</script>



<div id="editModal" class="modal">
  <div class="modal-content">
    <h4>Edit blog</h4>
    <form id="editForm" method="POST">
      <label for="title">Title:</label>
      <input type="text" id="modal-title" name="title" required>

      <label for="content">Content:</label>
      <textarea id="modal-content" name="content" required></textarea>

      <button class="btn btn-primary" type="submit">Update blog</button>
    </form>
  </div>
  <div class="modal-footer">
    <button id="closeModalBtn" class="btn btn-secondary">X</button>
  </div>
</div>

<%- include('include/footer') %>
